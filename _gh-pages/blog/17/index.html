
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Artsy Engineering</title>
  <meta name="author" content="">

  
  <meta name="description" content="
  
  
    
      
        



  
    
      
        
          
        
        
          Caching Model JSON with Mongoid-Cached-Json
        
...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:image" content="http://artsy.github.io/images/artsy_oss_image.png" />
  <meta property="og:image:type" content="image/png" />

  
  <link rel="canonical" href="http://artsy.github.io/blog/17/">
  <link rel="alternate" type="application/rss+xml" title="Artsy Engineering Blog" href="/feed">

  <link href="/favicon.png" rel="icon">
  <link href="/css/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

  <script src="/javascripts/jquery-1.11.3.min.js"> </script>
  <script src="/javascripts/gradient-fade.js"></script>
  <script src="/javascripts/noframework.waypoints.min.js"></script>
  <script src="/javascripts/sticky.min.js"></script>
  <script src="/javascripts/search.min.js"></script>

  

  <script type="text/javascript" src="https://fast.fonts.net/jsapi/f7f47a40-b25b-44ee-9f9c-cfdfc8bb2741.js"></script>


  <link href="" rel="alternate" title="Artsy Engineering" type="application/atom+xml">
  

  <!--[if IE 8]><link href="/stylesheets/custom/ie_font.css" type="text/css"><![endif]-->

</head>


<body>
  <div id="logo-container">
    <a id="lrg-mark" href="https://www.artsy.net/">
      <svg viewBox="0 0 510 510" width="40" height="40" xmlns="http://www.w3.org/2000/svg">
        <path transform="scale(1, -1) translate(0, -480)" d="M0 -32h512v512h-512v-512v0zM464 16h-80v80h-48v-80h-288v416h416v-416v0zM194 384h-40l-74 -186h38l20 52h72l19 -52h39l-74 186v0zM149 282l25 66l24 -66h-49v0z"/>
      </svg>
    </a>
  </div>
  <header id="banner"><div id="header">

  <div class="header-sticky-container">
    <div class="header-navigation-logo">
    </div>
    <div class="header-logo">
      <h2><a style="font-family:Arial Rounded MT Bold;color:white" href="http://themelonstudios.github.io">home</a></h2>
    </div>
    <div class="header-navigation">
      <ul>
        <li><a style="font-family:Arial Rounded MT Bold;color:white" href="https://developers.artsy.net/">Paint By Number</a></li>
        <li><a style="font-family:Arial Rounded MT Bold;color:white" href="https://www.artsy.net/jobs">Balls and Walls</a></li>
        <li><a style="font-family:Arial Rounded MT Bold;color:white" href="http://twitter.com/artsyopensource">trap</a></li>
        <li><a style="font-family:Arial Rounded MT Bold;color:white" href="http://www.artsy.net/">troid</a></li>
      </ul>
    </div>
  </div>
</div>
</header>
  <div class="header-hamburger">
    <button class="cmn-toggle-switch cmn-toggle-switch__htx">
      <span>toggle menu</span>
    </button>
  </div>
  <div id="main">
    <div id="content">

      <div class="blog-index">
  
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2012/02/20/caching-model-json-with-mongoid-cached-json/">
        
        
          <h2 class="entry-title">Caching Model JSON with Mongoid-Cached-Json</h2>
        
          <p class="meta-author">
  



  

  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>Consider the following two <a href="http://mongoid.org">Mongoid</a> domain models, <em>Widget</em> and <em>Gadget</em>.</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>widget.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Widget</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:name</span>
</span><span class='line'>  <span class="n">has_many</span> <span class="ss">:gadgets</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span>gadget.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Gadget</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Mongoid</span><span class="o">::</span><span class="no">Document</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:name</span>
</span><span class='line'>  <span class="n">field</span> <span class="ss">:extras</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:widget</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>And an API call that returns a collection of widgets.</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">get</span> <span class="s1">&#39;widgets&#39;</span> <span class="k">do</span>
</span><span class='line'>  <span class="no">Widget</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">as_json</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Given many widgets, the API makes a subquery to fetch the corresponding gadgets for each widget.</p>

<p>Introducing <a href="https://github.com/dblock/mongoid-cached-json">mongoid-cached-json</a>. This library mitigates several frequent problems with such code.</p>

<ul>
<li>Adds a declarative way of specifying a subset of fields to be returned part of <em>as_json</em>.</li>
<li>Avoids a large amount of subqueries by caching document JSONs participating in the parent-child relationship.</li>
<li>Provides a consistent strategy for restricting child documents' fields from being returned via the parent JSON.</li>
</ul>


<p>Using <em>Mongoid::CachedJson</em> we were able to cut our JSON API average response time by about a factor of 10. Find it <a href="https://github.com/dblock/mongoid-cached-json">on Github</a>.</p>

    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2012/02/03/reliably-testing-asynchronous-ui-w-slash-rspec-and-capybara/">
        
        
          <h2 class="entry-title">Reliably Testing Asynchronous UI w/ RSpec and Capybara</h2>
        
          <p class="meta-author">
  



  

  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>tl;dr - You can write 632 rock solid UI tests with Capybara and RSpec, too.</p>

<p><img src="Miami%20Weather%20in%20NYC" alt="/images/2012-02-03-reliably-testing-asynchronous-ui-w-slash-rspec-and-capybara/jenkins-ci.png" /></p>

<p>We have exactly 231 integration tests and 401 view tests out of a total of 3086 in our core application today. This adds up to 632 tests that exercise UI. The vast majority use <a href="http://rspec.info/">RSpec</a> with <a href="https://github.com/jnicklas/capybara">Capybara</a> and <a href="http://seleniumhq.org/">Selenium</a>. This means that every time the suite runs we set up real data in a local MongoDB and use a real browser to hit a fully running local application, 632 times. The suite currently takes 45 minutes to run headless on a slow Linode, UI tests taking more than half the time.</p>

<p>While the site is in private beta, you can get a glimpse of the complexity of the UI from the <a href="http://artsy.net">splash page</a>. It's a rich client-side Javascript application that talks to an API. You can open your browser's developer tools and watch a combination of API calls and many asynchronous events.</p>

<p>Keeping the UI tests reliable is notoriously difficult. For the longest time we felt depressed under the Pacific Northwest -like weather of our Jenkins CI and blamed every possible combination of code and infrastructure for the many intermittent failures. We've gone on sprees of marking many such tests "pending" too.</p>

<p>We've learned a lot and stabilized our test suite. This is how we do UI testing.</p>


        <p><a href="/blog/2012/02/03/reliably-testing-asynchronous-ui-w-slash-rspec-and-capybara/">Read on →</a></p>
    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2012/01/31/beyond-heroku-satellite-delayed-job-workers-on-ec2/">
        
        
          <h2 class="entry-title">Beyond Heroku: "Satellite" Delayed Job Workers on EC2</h2>
        
          <p class="meta-author">
  



  

  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>[TL;DR: To supplement Heroku-managed app servers, we launched custom EC2 instances to host Delayed Job worker processes. See the <a href="https://github.com/joeyAghion/satellite_setup">satellite_setup github repo</a> for rake tasks and Chef recipes that make it easy.]</p>

<p><a href="http://artsy.net">Artsy</a> engineers are big users and abusers of <a href="http://heroku.com">Heroku</a>. It's a neat abstraction of server resources, so we were conflicted when parts of our application started to bump into Heroku's limitations. While we weren't eager to start managing additional infrastructure, we found that--with a few good tools--we could migrate some components away from Heroku without fragmenting the codebase or over-complicating our development environments.</p>

<p>There are a number of reasons your app might need to go beyond Heroku. It might rely on a locally installed tool (not possible on Heroku's locked-down servers), or require heavy file-system usage (limited to <code>tmp/</code> and <code>log/</code>, and not permanent or shared). In our case, the culprit was Heroku's 512 MB RAM limit--reasonable for most web processes, but quickly exceeded by the image-processing tasks of our <a href="https://github.com/collectiveidea/delayed_job">delayed_job</a> workers. We considered building a specialized image-processing service, but decided instead to supplement our web apps with a custom <a href="http://aws.amazon.com/ec2/">EC2</a> instance dedicated to processing background tasks. We call these servers "satellites."</p>

<p>We'll walk through the pertinent sections here, but you can find Rake tasks that correspond with these scripts, plus all of the necessary cookbooks, in the <a href="https://github.com/joeyAghion/satellite_setup">satellite_setup github repo</a>. Now, on to the code!</p>

<p>First, generate a key-pair from <a href="https://console.aws.amazon.com/ec2/home?#s=KeyPairs">Amazon's AWS Management Console</a>. Then we'll use <a href="http://fog.io">Fog</a> to spawn the EC2 instance.</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;fog&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Update these values according to your environment...</span>
</span><span class='line'><span class="no">S3_ACCESS_KEY_ID</span> <span class="o">=</span> <span class="s1">&#39;XXXXXXXXXXXXXXXXXXXX&#39;</span>
</span><span class='line'><span class="no">S3_SECRET_ACCESS_KEY</span> <span class="o">=</span> <span class="s1">&#39;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#39;</span>
</span><span class='line'><span class="no">KEY_NAME</span> <span class="o">=</span> <span class="s1">&#39;satellite_keypair&#39;</span>
</span><span class='line'><span class="no">KEY_PATH</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;HOME&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/.ssh/</span><span class="si">#{</span><span class="no">KEY_NAME</span><span class="si">}</span><span class="s2">.pem&quot;</span>
</span><span class='line'><span class="no">IMAGE_ID</span> <span class="o">=</span> <span class="s1">&#39;ami-c162a9a8&#39;</span>  <span class="c1"># 64-bit Ubuntu 11.10</span>
</span><span class='line'><span class="no">FLAVOR_ID</span> <span class="o">=</span> <span class="s1">&#39;m1.large&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">connection</span> <span class="o">=</span> <span class="no">Fog</span><span class="o">::</span><span class="no">Compute</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">provider</span><span class="p">:</span> <span class="s1">&#39;AWS&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">aws_access_key_id</span><span class="p">:</span> <span class="no">S3_ACCESS_KEY_ID</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">aws_secret_access_key</span><span class="p">:</span> <span class="no">S3_SECRET_ACCESS_KEY</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">server</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">servers</span><span class="o">.</span><span class="n">bootstrap</span><span class="p">(</span>
</span><span class='line'>  <span class="ss">key_name</span><span class="p">:</span> <span class="no">KEY_NAME</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">private_key_path</span><span class="p">:</span> <span class="no">KEY_PATH</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">image_id</span><span class="p">:</span> <span class="no">IMAGE_ID</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">flavor_id</span><span class="p">:</span> <span class="no">FLAVOR_ID</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>Next, we'll do some basic server prep and install our preferred Ruby version.
        <p><a href="/blog/2012/01/31/beyond-heroku-satellite-delayed-job-workers-on-ec2/">Read on →</a></p>
    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2012/01/31/delaying-carrierwave-image-processing/">
        
        
          <h2 class="entry-title">Delaying CarrierWave Image Processing</h2>
        
          <p class="meta-author">
  



  

  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>We do a lot of image processing at Artsy. We have tens of thousands of beautiful original high resolution images from our partners and treat them with care. The files mostly come from professional art photographers, include embedded color profiles and other complicated features that make image processing a big deal.</p>

<p>Once uploaded, these images are converted to JPG, resized into many versions and often resampled. We are using <a href="https://github.com/jnicklas/carrierwave">CarrierWave</a> for this process - our typical image uploader starts like a usual CarrierWave implementation with a few additional features.</p>


        <p><a href="/blog/2012/01/31/delaying-carrierwave-image-processing/">Read on →</a></p>
    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2012/01/29/how-art-dot-sy-uses-github-to-build-art-dot-sy/">
        
        
          <h2 class="entry-title">How Artsy Uses GitHub to Build Artsy</h2>
        
          <p class="meta-author">
  



  

  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p><a href="http://zachholman.com/">Zach Holman</a> gave a good talk on <a href="http://zachholman.com/talk/how-github-uses-github-to-build-github">How GitHub uses GitHub to build GitHub</a> at Rubyconf. It was great to hear how similar our own processes are at Artsy, with a few notable differences.</p>

<p>Artsy engineers store almost everything on GitHub. We use GitHub Wikis, but don't use GitHub Issues much. We work in 3-week sprints with <a href="http://pivotaltracker.com/">Pivotal Tracker</a> instead. This blog is on GitHub. And, of course, we have our own Hubot which feeds funny animated GIFs after each successful deploy to our IRC channel.</p>

<p>The most interesting part for me was around these two slides.</p>

<p><img src="/images/2012-01-29-how-art-dot-sy-uses-github-to-build-art-dot-sy/github-pull.png" alt="Pull" /></p>

<p><img src="/images/2012-01-29-how-art-dot-sy-uses-github-to-build-art-dot-sy/github-fork.png" alt="Fork" /></p>

<p>Zach emphasized that you don't need forks to make pull requests. While technically true, I find forks particularly useful to keep things clean.</p>

<p>At Artsy we use personal forks to work on features, create topical branches and make pull requests into the master from there. This is the workflow of the vast majority of open-source projects too. Now, Zach is right, you don't want to create any second class developers - our entire team has write access to the master. We use pull requests from forks to do peer code reviews, even for trivial things. I would typically make a pull request including the person I'd like to code review my changes in the title. Here's an example.</p>

<p><img src="/images/2012-01-29-how-art-dot-sy-uses-github-to-build-art-dot-sy/github-pull-request.png" alt="Targeted Pull Request" /></p>

<p>(Notice the use of hash rocket. Zach, Ruby has transcended our lives too.)</p>

<p>Working on forks keeps developer branches away from "master". The main repository only has three branches: "master", "staging" and "production" and each developer can make up whatever branching strategy they like in individual forks.</p>

<p>Code reviews have nothing to do with hierarchy or organization, any developer will code review any other developer's work. We tend to avoid using the same person for two subsequent code reviews to prevent excessive buddying. Zach called his pull requests "collective experiments" - a place for active discussions, rejections and praise. I really like that. Each of my rejected pull requests has been a great learning experience.</p>

    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2012/01/18/octopress-and-jekyll/">
        
        
          <h2 class="entry-title">Octopress and Jekyll</h2>
        
          <p class="meta-author">
  



  

  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>This blog is powered by static pages.</p>

<p>I think it's quite ironic that, while we spend a lot of time building complex large scale dynamic websites, our new favorite publishing platform is a system that compiles static content. But, in many ways, <a href="http://octopress.org/">Octopress</a> and <a href="https://github.com/mojombo/jekyll">Jekyll</a> fit our philosophy and developer workflow perfectly. Writing an article for this blog means using the same tools and processes as contributing to a project on Github. And everyone is welcome to browse and learn from <a href="https://github.com/artsy/artsy.github.com/tree/source">the source</a> of this blog, and even fork it and contribute fixes to the layout or even blog features.</p>

<p>Here's what Artsy engineers do to get setup (once) and publish a new post.</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git clone git@github.com:artsy/artsy.github.com.git
</span><span class='line'> Cloning into artsy.github.com...
</span><span class='line'>
</span><span class='line'><span class="nv">$ </span><span class="nb">cd </span>artsy.github.com
</span><span class='line'>
</span><span class='line'>artsy.github.com<span class="nv">$ </span>git checkout <span class="nb">source</span>
</span><span class='line'><span class="nb"> </span>Branch <span class="nb">source set </span>up to track remote branch <span class="nb">source </span>from origin.
</span><span class='line'> Switched to a new branch <span class="s1">&#39;source&#39;</span>
</span><span class='line'>
</span><span class='line'>artsy.github.com<span class="nv">$ </span>mkdir _deploy
</span><span class='line'>
</span><span class='line'>artsy.github.com<span class="nv">$ </span><span class="nb">cd </span>_deploy
</span><span class='line'>
</span><span class='line'>artsy.github.com/_deploy<span class="nv">$ </span>git init
</span><span class='line'> Initialized empty Git repository in artsy.github.com/_deploy/.git/
</span><span class='line'>
</span><span class='line'>artsy.github.com/_deploy<span class="nv">$ </span>git remote add origin git@github.com:artsy/artsy.github.com.git
</span><span class='line'>
</span><span class='line'>artsy.github.com/_deploy<span class="nv">$ </span>git pull origin master
</span><span class='line'> From github.com:artsy/artsy.github.com
</span><span class='line'>  * branch            master     -&gt; FETCH_HEAD
</span><span class='line'>
</span><span class='line'>artsy.github.com/_deploy<span class="nv">$ </span><span class="nb">cd</span> ..
</span><span class='line'>
</span><span class='line'>artsy.github.com<span class="nv">$ </span>rake create_post<span class="o">[</span><span class="s2">&quot;Octopress and Jekyll&quot;</span><span class="o">]</span>
</span><span class='line'> Creating new post: <span class="nb">source</span>/_posts/2012-01-18-octopress-and-jekyll.md
</span><span class='line'>
</span><span class='line'>artsy.github.com<span class="nv">$ </span>git commit -am <span class="s2">&quot;Octopress and Jekyll&quot;</span>
</span><span class='line'> <span class="m">1</span> files changed, <span class="m">52</span> insertions<span class="o">(</span>+<span class="o">)</span>, <span class="m">0</span> deletions<span class="o">(</span>-<span class="o">)</span>
</span><span class='line'> create mode <span class="m">100644</span> <span class="nb">source</span>/_posts/2012-01-18-octopress-and-jekyll.md
</span><span class='line'>
</span><span class='line'>artsy.github.com<span class="nv">$ </span>rake deploy
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>(If you're confused by the setup, check out <a href="http://code.dblock.org/octopress-setting-up-a-blog-and-contributing-to-an-existing-one">this post</a>).</p>

<p>We believe in simple systems and love the opportunity to understand technology in-depth. Everything you see, short of the blog content and styles, is written in Ruby by very smart people. The source is open and free, which helps us learn and make progress, together.</p>

    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2012/01/17/responsive-layouts-with-css3/">
        
        
          <h2 class="entry-title">Responsive Layouts with CSS3</h2>
        
          <p class="meta-author">
  



  

  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>All of the <a href="http://sass-lang.com/">SCSS</a> stylesheets used to design this blog compile down to one file (view the source of this page and check out screen.css), and there isn't any JavaScript affecting the layout. But there are really three versions of this page. If you're reading this on a smartphone, what you see is almost entirely different from what you would see if you were reading this in a full screen browser. If you're on a computer, try making this page full screen and slowly resize it to make it smaller. You'll first notice that the Artsy logo disappears just before it would cover the text in the main column. Keep reducing the viewport and eventually the page will snap into a mobile format with the Artsy logo centered at the top, followed by the centered header text and mobile search box all above the index of recent posts.</p>

<a name="The.Philosophy"></a>
<h2>The Philosophy</h2>

<p>Why bother? It's true that smartphone web browsers are pretty advanced and certainly can handle rendering the full version of this blog. But there's a big difference between ensuring a site works and creating a good experience for your audience regardless of the device they're using. If anything, advances in the mobile web make responsive layouts like the one on this blog even more necessary — as it becomes more and more likely that your users are viewing your site on a handheld screen, it becomes less acceptable to force your audience to zoom way into your page and follow the text with their thumbs.</p>

<p>The key to a good mobile design is to fix at least one axis — it's fine if the user has to scroll down or to the right to see the rest of the content, but making the user scroll diagonally means that the layout doesn't fit the screen. For text-heavy sites like this blog, it's best to just allow vertical scrolling. Aside from this consideration, links, text fields, and buttons must be large enough to allow for easy navigation with thumbs. The font size may need to be adjusted to optimize viewing on a mobile screen. On a Mac, you can use mobile Safari on the iPhone Simulator that comes with <a href="http://developer.apple.com/xcode/">Xcode</a> to see how your site will look on a phone.</p>

<a name="Media.Queries"></a>
<h2>Media Queries</h2>

<p>The good news is that these responsive layouts aren't difficult to implement. When I set out to theme this <a href="http://octopress.org/">Octopress</a> blog, our designer gave me two comps, one for the full version of the site and the other for the mobile version. The first step towards a responsive layout is to notice common elements between the two designs. If you compare the two versions of the blog, you'll notice that they contain essentially the same content. This means that we need only one template file for both designs, and definitely do not need to resort to creating a whole mobile subdomain to serve different content to small screens. For elements that aren't the same in the two designs, we can simply hide them by setting <code>display: none</code> for devices where the elements shouldn't be shown. I used this technique in a couple of places on the blog: the right sidebar is hidden on the mobile version, while the mobile search bar (which differs from the search bar on the side in that it has placeholder text and appears in the main content <code>div</code>) isn't displayed on the full version of the site.</p>

<p>But how do you apply different styles to the same elements depending on the size of the browser's viewport? There are a couple of ways, but by far the cleanest way is to use CSS3 media queries. Media queries allow developers to apply different styles to elements on a page depending on the media on which they are displayed, whether that medium is a screen, a projection, print, braille, etc. The most common use of media queries, however, is to create responsive layouts. Media queries come after an <code>@media</code> declaration. Directly after comes the definition of the media type: we're concerned with creating responsive layouts for screens, and as a result, we'll declare our styles under <code>@media screen</code>. To apply custom styles based on the size of the screen, we'll use media features, which come after the keyword <code>and</code> and are enclosed in parentheses. Here's the SCSS code used to style the Artsy logo on this blog:</p>

<div class='bogus-wrapper'><notextile><figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='scss'><span class='line'><span class="nn">#lrg-mark</span> <span class="p">{</span>
</span><span class='line'>    <span class="na">background-image</span><span class="o">:</span> <span class="sx">url(&quot;../images/Logo.png&quot;)</span><span class="p">;</span>
</span><span class='line'>    <span class="na">background-repeat</span><span class="o">:</span> <span class="no">no-repeat</span><span class="p">;</span>
</span><span class='line'>    <span class="na">display</span><span class="o">:</span> <span class="no">block</span><span class="p">;</span>
</span><span class='line'>    <span class="na">height</span><span class="o">:</span> <span class="mi">92</span><span class="kt">px</span><span class="p">;</span>
</span><span class='line'>    <span class="na">width</span><span class="o">:</span> <span class="mi">249</span><span class="kt">px</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nt">span</span> <span class="p">{</span>
</span><span class='line'>      <span class="na">display</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">@media</span> <span class="nt">screen</span> <span class="nt">and</span> <span class="o">(</span><span class="nt">min-width</span><span class="nd">:</span> <span class="nt">482px</span><span class="o">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="na">left</span><span class="o">:</span> <span class="mi">35</span><span class="kt">px</span><span class="p">;</span>
</span><span class='line'>      <span class="na">position</span><span class="o">:</span> <span class="no">fixed</span><span class="p">;</span>
</span><span class='line'>      <span class="na">top</span><span class="o">:</span> <span class="mi">15</span><span class="kt">px</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">@media</span> <span class="nt">screen</span> <span class="nt">and</span> <span class="o">(</span><span class="nt">max-width</span><span class="nd">:</span> <span class="nt">1280px</span><span class="o">)</span> <span class="nt">and</span> <span class="o">(</span><span class="nt">min-width</span><span class="nd">:</span> <span class="nt">482px</span><span class="o">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="na">display</span><span class="o">:</span> <span class="no">none</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">@media</span> <span class="nt">screen</span> <span class="nt">and</span> <span class="o">(</span><span class="nt">max-width</span><span class="nd">:</span> <span class="nt">481px</span><span class="o">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="na">margin</span><span class="o">:</span> <span class="mi">0</span> <span class="no">auto</span> <span class="mi">20</span><span class="kt">px</span> <span class="no">auto</span><span class="p">;</span>
</span><span class='line'>      <span class="na">background-position</span><span class="o">:</span> <span class="no">center</span> <span class="no">top</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>


<p>The styles that are common to all viewports are written outside of <code>@media</code> declarations at the top of the styles for <code>#lrg-mark</code> — regardless of the screen size, we want the logo to be the same image and the same size, and we don't want to display the span inside of the div that contains fallback text. The rest of the styles are given in media queries: for a large viewport, we want the logo fixed in the upper right corner, for slightly smaller viewports, we want it to disappear, and for mobile viewports, we want it centered on the screen. Note that 481px is a magic number: it's the width of an iPhone in landscape mode.</p>

<p>The media features <code>max-width</code> and <code>min-width</code> are a little misleading: they don't mean the maximum or minimum possible width of the user's screen. It's best to think of <code>max-</code> as "less-than-or-equal-to" and <code>min-</code> as "greater-than-or-equal-to." See <a href="http://www.w3.org/TR/css3-mediaqueries/">the W3C's website</a> for a complete reference on CSS media queries.</p>

<a name="Making.It.Cross-Browser"></a>
<h2>Making It Cross-Browser</h2>

<p>CSS3 media queries are awesome, but even though all the latest versions of the major browsers support them, it's very likely that a portion of your site's visitors will be using browsers that don't support these new CSS features. Luckily, this problem has already been solved by great people who like to give away things for free. Just include <a href="https://github.com/Modernizr/Modernizr">modernizr.js</a> on your page, and it will provide a JavaScript fallback for media queries, as well as for many other potentially unsupported CSS3 features.</p>

    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  
    
      <article>
        
<div class="article-container">


  
    <div class="meta-container">
      <header>
        
          <a href="/blog/2012/01/05/hello-world/">
        
        
          <h2 class="entry-title">Hello World</h2>
        
          <p class="meta-author">
  



  

  

</p>
          </a>
      </header>
    </div>
  

  <div class="content-container">
    
    
        <p>We've been building cool stuff at <a href="http://artsy.net">Artsy</a> and are looking forward to sharing all things tech with you.</p>

    

    

    
  </div>


  <footer>
  </footer>

</div>

      </article>
  

  <div class="pagination">
    <a href="/blog/archives">Blog Archives</a>

    
      <a href="/blog/16/" class="previous">Previous</a>
    
    <span class="page_number ">Page: 17 of 17</span>

    
  </div>
</div>


    </div>
  </div>
  <footer id="main_footer"> <div class="footer-navigation">
  <ul>
    <li><a href="https://developers.artsy.net/">API</a></li>
    <li><a href="https://www.artsy.net/jobs">Careers</a></li>
    <li><a href="http://twitter.com/artsyopensource">@artsyopensource</a></li>
    <li><a href="http://www.artsy.net/">Artsy.net</a></li>
  </ul>
</div>



<script type="text/javascript">
      var disqus_shortname = 'artsy';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


</footer>
  <script type="text/javascript">
  $(function() {
    // TODO: Move this whole file to a javascript file that is included in the footer

    // Main sticky header
    if ($(window).width() >= 700) {
      var sticky = new Waypoint.Sticky({
        element: $("#banner"),
        offset: -100
      });
    }

    // Toggle hamburger menu
    $('.header-hamburger').click(function() {
      $('#banner, .cmn-toggle-switch').toggleClass('active');
      if (location.pathname == '/open-source') {
        $('.header-search span').hide();
        $('#page-sidebar').toggle();
      }
    });

    // Toggle search focus on mobile
    $('input.search').focus(function() {
      $('#header').addClass('search-focused');
    }).blur(function() {
      $('#header').removeClass('search-focused');
    });
  });
</script>

</body>
</html>
